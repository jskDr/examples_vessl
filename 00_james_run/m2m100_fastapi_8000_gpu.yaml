name: m2m100_fastapi_8000_gpu
description: Try to use fastapi with GPU
tags:
  - fastapi
service_account_name: ""
termination_protection: false
import:
  /root/code/:
    git:
      url: bitbucket.org/tecacedev/ai_m2m100_ft.git
      ref: master
      credential_name: james.kim@tecace.com
  /root/.ssh/: vessl-dataset://tecace/KeyFiles
resources:
  cluster: vessl-gcp-oregon
  preset: gpu-l4-small-spot
image: quay.io/vessl-ai/torch:2.4.0-cuda12.4-r1
run:
  - command: chmod 700 ~/.ssh/id_rsa
    workdir: /root
  - command: |-
      pip install fastapi
      pip install pydantic
      pip install transformers
      pip install sentencepiece
      pip install torch
      uvicorn main:app --host 0.0.0.0 --port 8000 --reload
    workdir: /root/code/fastapi_serve
  - command: |-
      git config user.name "James Kim"
      git config user.email "james.kim@tecace.com"
      git remote set-url origin git@bitbucket.org:tecacedev/ai_m2m100_ft.git
    workdir: /root/code
ports:
  - name: fastapi
    type: http
    port: 8000
